<template>    <Header/>    <div class="content">        <div class="title">历史记录</div>        <HistoryItem v-for="item in historyList" :item="item" @update="init({pageSize})"/>    </div></template><script>import Header from '@/components/Header'import HistoryItem from '@/components/HistoryItem'import {onBeforeUnmount, onMounted, reactive} from 'vue'import request from '@/utils/request'import {GetPlays} from '@/utils/Constant'export default {    name: 'HistoryPage',    components: {HistoryItem, Header},    setup() {        let historyList = reactive([])        let isLoading = false        let pageSize = 10        let isEnd = false        function init(data) {            isLoading = true            request.post(GetPlays, data).then(res => {                if (res.data.code === 0) {                    historyList.length = 0                    historyList.push(...res.data.data)                }            }).finally(() => {                isLoading = false            })        }        function scrollDynamic() {            try {                if (!isLoading && !isEnd) {                    if (document.getElementById('app').offsetHeight - window.scrollY - window.innerHeight < 50) {                        isLoading = true                        let data = {pageSize: pageSize}                        if (historyList.length > 0) {                            data.playId = historyList[historyList.length - 1].play.id                        }                        request.post(GetPlays, data).then(res => {                            if (res.data.code === 0) {                                historyList.push(...res.data.data)                                if (res.data.data.length < pageSize) {                                    isEnd = true                                }                            }                        }).finally(() => {                            isLoading = false                        })                    }                }            } catch (e) {            }        }        onMounted(() => {            let data = {pageSize: pageSize}            init(data)            window.addEventListener('scroll', scrollDynamic)        })        onBeforeUnmount(() => {            window.removeEventListener('scroll', scrollDynamic)        })        return {            historyList,            pageSize,            init,        }    },}</script><style scoped>.content {    margin: 0 auto;    width: 1000px;}.title {    font-size: 20px;    margin: 20px 0;}</style>