<template>    <div class="background">        <Header/>        <div :class="showTop ? 'top-header show' : 'top-header'" v-if="!isLoading">            <div class="inner">                <div class="left">{{ dynamic.dynamic.title }}</div>                <div class="right">                    <div class="user-header">                        <img @click="to(`/space/${dynamic.user.id}`)"                             :src="dynamic.user.avatar === '' ? logo : dynamic.user.avatar" alt="">                        <div class="username" @click="to(`/space/${dynamic.user.id}`)">{{ dynamic.user.nickname }}</div>                    </div>                    <div class="button" v-if="userDetail.id !== dynamic.user.id">                        <div v-show="!isSubscribe" @click="subscribe" class="subscribe-button">关注</div>                        <div v-show="isSubscribe" @click="unsubscribe" class="unsubscribe-button">取消关注</div>                    </div>                </div>            </div>        </div>        <div id="content" v-if="!isLoading">            <div class="content">                <h1 class="title">{{ dynamic.dynamic.title }}</h1>                <div class="dynamic-detail">                    <span>{{ dynamic.dynamic.createTime.replace('T', ' ') }}</span>                    <span>{{ commentNum + '评论' }}</span>                </div>                <div class="detail">                    <div class="user">                        <img class="avatar" @click="to(`/space/${dynamic.user.id}`)"                             :src="dynamic.user.avatar === '' ? logo : dynamic.user.avatar" alt="">                        <div class="user-detail">                            <div class="username" @click="to(`/space/${dynamic.user.id}`)">{{                                    dynamic.user.nickname                                }}                            </div>                            <div class="subscribe-num">{{ '粉丝：' + fanNum }}</div>                        </div>                    </div>                    <div class="button" v-if="userDetail.id !== dynamic.user.id">                        <div v-show="!isSubscribe" @click="subscribe" class="subscribe-button">关注</div>                        <div v-show="isSubscribe" @click="unsubscribe" class="unsubscribe-button">取消关注</div>                    </div>                </div>                <div id="editor" v-show="!isRender">                    <textarea>{{dynamic.dynamic.content}}</textarea>                </div>            </div>            <div class="comment-content">                <div class="comment-num">{{ commentNum + ' ' }}评论</div>                <Comment :dynamicId="dynamic.dynamic.id" :toUserId="dynamic.user.id"/>            </div>            <div class="pic-background" v-show="picShow">                <div class="close" @click="closePicShow">                    <svg viewBox="0 0 40 40">                        <path                            d="M22.83,20,38.42,4.41a2,2,0,1,0-2.83-2.83h0L20,17.17,4.41,1.58A2,2,0,0,0,1.58,4.41L17.17,20,1.58,35.59a2,2,0,0,0,2.83,2.83L20,22.83,35.59,38.42a2,2,0,1,0,2.83-2.83Z"></path>                    </svg>                </div>                <img @wheel.stop.prevent="wheel" @drag.stop.prevent @dragstart.prevent.stop @mousedown="move"                     @mouseup="mouseDown = false"                     :src="picSrc" alt="" id="pic">            </div>        </div>    </div></template><script>import Header from '@/components/Header'import {onBeforeUnmount, onMounted, ref} from 'vue'import Comment from '@/components/Comment'import {useRoute, useRouter} from 'vue-router'import request from '@/utils/request'import {    AddPlay,    GetCommentCount,    GetDynamicById, GetFanNum,    GetIsSubscribe,    READ_TYPE,    Subscribe,    Unsubscribe,} from '@/utils/Constant'import logo from '@/assets/logo.png'export default {    name: 'ReadPage',    components: {Comment, Header},    setup() {        let route = useRoute()        let router = useRouter()        let dynamic = ref()        let isSubscribe = ref(false)        let fanNum = ref(0)        let commentNum = ref(0)        let isLoading = ref(true)        let userDetail = JSON.parse(localStorage.getItem('user'))        let isRender = ref(true)        let picShow = ref(false)        let picSrc = ref('')        let scale = ref(1)        let mouseDown = ref(false)        let showTop = ref(false)        function init() {            request.post(`${GetDynamicById}`, {                dynamicId: route.params.id,                type: READ_TYPE,            }).then(res => {                if (res.data.code === 0) {                    dynamic.value = res.data.data                    request.get(`${GetIsSubscribe}/${dynamic.value.dynamic.userId}`).then(res => {                        if (res.data.code === 0) {                            isSubscribe.value = res.data.data.isSubscribe                        }                    })                    request.get(`${GetFanNum}/${dynamic.value.dynamic.userId}`).then(res => {                        if (res.data.code === 0) {                            fanNum.value = res.data.data.fanNum                        }                    })                    request.get(`${GetCommentCount}/${route.params.id}`).then(res => {                        if (res.data.code === 0) {                            commentNum.value = res.data.data.commentNum                        }                    })                    setTimeout(() => {                        editormd.markdownToHTML('editor', {                            htmlDecode: 'style,script,iframe',                        })                        hljs.configure({                            ignoreUnescapedHTML: true,                        })                        $('pre code').each(function(i, block) {                            hljs.highlightElement(block)                        })                        isRender.value = false                        let img = $('#editor img')                        img.click((e) => {                            picShow.value = true                            picSrc.value = e.target.src                            $('html').css({'overflow': 'hidden'})                        })                        img.css({'cursor': 'zoom-in'})                    }, 100)                    request.post(AddPlay, {dynamicId: dynamic.value.dynamic.id})                } else {                    router.push('/')                }            }).finally(() => {                isLoading.value = false            })        }        onMounted(() => {            init()            window.addEventListener('scroll', showHeader)        })        onBeforeUnmount(() => {            window.removeEventListener('scroll', showHeader)        })        function subscribe() {            request.get(`${Subscribe}/${dynamic.value.user.id}`).then(res => {                if (res.data.code === 0) {                    isSubscribe.value = true                }            })        }        function unsubscribe() {            request.get(`${Unsubscribe}/${dynamic.value.user.id}`).then(res => {                if (res.data.code === 0) {                    isSubscribe.value = false                }            })        }        function to(path) {            window.open(router.resolve(path).href, '_blank')        }        function wheel(event) {            if (event.wheelDelta > 0) {                scale.value += 0.05            } else {                scale.value -= 0.05            }            event.target.style.transform = `scale(${scale.value})`        }        function move(e) {            mouseDown.value = true            e.target.onmousemove = function(event) {                if (mouseDown.value) {                    event.target.style.left = event.clientX - event.target.offsetWidth / 2 + 'px'                    event.target.style.top = event.clientY - event.target.offsetHeight / 2 + 'px'                }            }        }        function closePicShow() {            picShow.value = false            scale.value = 1            $('#pic')[0].style.transform = `scale(${scale.value})`            $('html').css({'overflow': 'auto'})        }        function showHeader() {            showTop.value = window.scrollY >= 300        }        return {            dynamic,            isSubscribe,            fanNum,            isLoading,            commentNum,            userDetail,            isRender,            picShow,            picSrc,            mouseDown,            showTop,            subscribe,            unsubscribe,            to,            wheel,            move,            closePicShow,            showHeader,            logo,        }    },}</script><style scoped>.background {    width: 100%;    min-height: 100vh;    background-color: #f6f7f9;}#content {    margin: 0 auto;    width: 820px;    display: flex;    flex-direction: column;}.content {    background-color: white;    padding: 30px 40px 40px 40px;    margin-top: 30px;}.title {    margin-bottom: 20px;}.avatar {    width: 80px;    height: 80px;    cursor: pointer;    border-radius: 50%;}.dynamic-detail span {    margin-right: 20px;    color: #999999;    font-size: 14px;}.detail {    display: flex;    justify-content: space-between;    align-items: center;    border-bottom: #e9e9e9 solid 1px;}.user {    display: flex;}.user-detail {    display: flex;    flex-direction: column;    justify-content: center;}.username {    font-size: 14px;    cursor: pointer;    margin-right: 10px;}.subscribe-num {    font-size: 14px;    color: #999999;}.subscribe-button {    display: flex;    justify-content: center;    align-items: center;    width: 76px;    height: 30px;    border-radius: 4px;    background-color: #00a1d6;    color: white;    font-size: 14px;    border: white 1px solid;    cursor: pointer;}.unsubscribe-button {    display: flex;    justify-content: center;    align-items: center;    width: 76px;    height: 30px;    border-radius: 4px;    background-color: rgba(0, 0, 0, .45);    color: white;    font-size: 14px;    border: white 1px solid;    cursor: pointer;}.comment-content {    margin-top: 20px;    background-color: white;    padding: 40px;}.comment-num {    font-size: 18px;}.pic-background {    position: fixed;    top: 0;    left: 0;    right: 0;    bottom: 0;    background-color: rgba(85, 85, 85, .3);    z-index: 900;    display: flex;    justify-content: center;    align-items: center;}.pic-background img {    max-height: 100vh;    max-width: 100vw;    z-index: 999;    position: absolute;    cursor: move;}.close {    position: absolute;    top: 30px;    right: 30px;    width: 40px;    height: 40px;    cursor: pointer;    z-index: 1000;}.top-header {    position: fixed;    top: -60px;    width: 100%;    height: 56px;    background-color: white;    box-shadow: 0 1px 2px rgb(0 0 0 / 14%);    left: 0;    z-index: 100;    transition: all .3s;}.inner {    display: flex;    width: 900px;    justify-content: space-between;    align-items: center;    margin: 0 auto;    height: 100%;}.left {    max-width: 650px;    font-weight: 700;    display: -webkit-box;    overflow: hidden;    -webkit-box-orient: vertical;    text-overflow: -o-ellipsis-lastline;    text-overflow: ellipsis;    word-break: break-all;    -webkit-line-clamp: 1;    font-size: 21px;}.right {    display: flex;    align-items: center;    justify-content: center;}.right img {    width: 28px;    height: 28px;    border-radius: 50%;    margin-right: 10px;    cursor: pointer;}.user-header {    display: flex;    justify-content: center;    align-items: center;}.show {    top: 0;}</style><style>pre ol span {    white-space: pre;}pre {    position: relative;    background: #21252b !important;    border-radius: 5px;    font: 15px/22px "Microsoft YaHei", "Arial", Sans-Serif;    line-height: 1.6;    margin-bottom: 1.6em;    max-width: 100%;    overflow: auto;    text-shadow: none;    color: #000;    padding-top: 30px;    box-shadow: 0 10px 10px 0 rgb(0 0 0 / 40%);}.editormd-html-preview pre.prettyprint {    border: 0;}li.L1, li.L3, li.L5, li.L7, li.L9 {    background: none;}pre {    position: relative;    padding: 30px 10px 10px 10px !important;}pre::after {    display: block;    content: " ";    position: absolute;    border-radius: 50%;    background: #ff5f56;    width: 12px;    height: 12px;    top: 0;    left: 12px;    margin-top: 12px;    -webkit-box-shadow: 20px 0 #ffbd2e, 40px 0 #27c93f;    box-shadow: 20px 0 #ffbd2e, 40px 0 #27c93f;}.markdown-body pre li {    border-left: 1px solid #6c7978;    padding-left: 10px}</style>