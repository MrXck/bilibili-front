<template>    <div class="dynamic">        <div class="option">            <svg v-show="rollIndex === 0" data-name="上一个" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 492 492">                <path                    d="M198.608 246.104L382.664 62.04c5.068-5.056 7.856-11.816 7.856-19.024 0-7.212-2.788-13.968-7.856-19.032l-16.128-16.12C361.476 2.792 354.712 0 347.504 0s-13.964 2.792-19.028 7.864L109.328 227.008c-5.084 5.08-7.868 11.868-7.848 19.084-.02 7.248 2.76 14.028 7.848 19.112l218.944 218.932c5.064 5.072 11.82 7.864 19.032 7.864 7.208 0 13.964-2.792 19.032-7.864l16.124-16.12c10.492-10.492 10.492-27.572 0-38.06L198.608 246.104z"                    fill="#ccd0d7"/>            </svg>            <svg v-show="rollIndex > 0" @click="pre" class="roll" data-name="上一个" xmlns="http://www.w3.org/2000/svg"                 viewBox="0 0 492 492">                <path                    d="M198.608 246.104L382.664 62.04c5.068-5.056 7.856-11.816 7.856-19.024 0-7.212-2.788-13.968-7.856-19.032l-16.128-16.12C361.476 2.792 354.712 0 347.504 0s-13.964 2.792-19.028 7.864L109.328 227.008c-5.084 5.08-7.868 11.868-7.848 19.084-.02 7.248 2.76 14.028 7.848 19.112l218.944 218.932c5.064 5.072 11.82 7.864 19.032 7.864 7.208 0 13.964-2.792 19.032-7.864l16.124-16.12c10.492-10.492 10.492-27.572 0-38.06L198.608 246.104z"                    fill="#99a2aa"/>            </svg>        </div>        <div class="middle" ref="middle">            <div @click="switchDynamic(0)" :class="listIndex === 0 ? 'up active' : 'up'">                <img class="up-avatar" :src="logo" alt="">                <span class="up-username">全部动态</span>            </div>            <div @click="switchDynamic(index + 1, item.id)" :class="listIndex === index + 1 ? 'up active' : 'up'"                 v-for="(item, index) in list">                <img class="up-avatar" :src="item.avatar === '' ? logo : item.avatar" alt="">                <span class="up-username">{{ item.nickname }}</span>            </div>        </div>        <div class="option">            <svg v-show="rollIndex === roll - 1" data-name="下一个" xmlns="http://www.w3.org/2000/svg"                 viewBox="0 0 492 492">                <path                    d="M382.678 226.804L163.73 7.86C158.666 2.792 151.906 0 144.698 0s-13.968 2.792-19.032 7.86l-16.124 16.12c-10.492 10.504-10.492 27.576 0 38.064L293.398 245.9l-184.06 184.06c-5.064 5.068-7.86 11.824-7.86 19.028 0 7.212 2.796 13.968 7.86 19.04l16.124 16.116c5.068 5.068 11.824 7.86 19.032 7.86s13.968-2.792 19.032-7.86L382.678 265c5.076-5.084 7.864-11.872 7.848-19.088.016-7.244-2.772-14.028-7.848-19.108z"                    fill="#ccd0d7"/>            </svg>            <svg v-show="rollIndex < roll - 1" @click="next" class="roll" data-name="下一个"                 xmlns="http://www.w3.org/2000/svg"                 viewBox="0 0 492 492">                <path                    d="M382.678 226.804L163.73 7.86C158.666 2.792 151.906 0 144.698 0s-13.968 2.792-19.032 7.86l-16.124 16.12c-10.492 10.504-10.492 27.576 0 38.064L293.398 245.9l-184.06 184.06c-5.064 5.068-7.86 11.824-7.86 19.028 0 7.212 2.796 13.968 7.86 19.04l16.124 16.116c5.068 5.068 11.824 7.86 19.032 7.86s13.968-2.792 19.032-7.86L382.678 265c5.076-5.084 7.864-11.872 7.848-19.088.016-7.244-2.772-14.028-7.848-19.108z"                    fill="#99a2aa"/>            </svg>        </div>    </div></template><script>import logo from '../assets/logo.png'import {getCurrentInstance, onMounted, reactive, ref, onBeforeUnmount} from 'vue'import request from '@/utils/request'import {GetDynamic, GetNewSubscribe} from '@/utils/Constant'import {useMainStore} from '@/store'export default {    name: 'Dynamic',    setup() {        let list = reactive([])        let listIndex = ref(0)        let roll = ref(0)        let rollIndex = ref(0)        let middle = null        let mainStore = useMainStore()        let isLoading = false        let isEnd = false        function init() {            request.get(GetNewSubscribe).then(res => {                if (res.data.code === 0) {                    list.length = 0                    list.push(...res.data.data.users)                    roll.value = Math.ceil(list.length / 8)                }            })            mainStore.dynamicList.length = 0            mainStore.userId = ''            getDynamic({})        }        function getDynamic(data){            request.post(GetDynamic, data).then(res => {                if (res.data.code === 0) {                    mainStore.dynamicList.push(...res.data.data)                }            })        }        function switchDynamic(index, userId){            let data = {}            mainStore.userId = ''            isEnd = false            if (userId !== undefined && userId !== null) {                data.userId = userId                mainStore.userId = userId            }            if (index !== undefined && index !== null) {                listIndex.value = index            }            mainStore.dynamicList.length = 0            getDynamic(data)        }        function scrollDynamic(){            try {                if (!isLoading && !isEnd) {                    if (document.getElementById('app').offsetHeight - window.scrollY - window.innerHeight < 50) {                        let data = {}                        if (mainStore.userId !== '') {                            data.userId = mainStore.userId                        }                        data.dynamicId = mainStore.dynamicList[mainStore.dynamicList.length - 1].dynamic.id                        isLoading = true                        request.post(GetDynamic, data).then(res => {                            if (res.data.code === 0) {                                mainStore.dynamicList.push(...res.data.data)                                if (res.data.data.length === 0) {                                    isEnd = true                                }                            }                        }).finally(() => {                            isLoading = false                        })                    }                }            } catch (e) {            }        }        onMounted(() => {            middle = getCurrentInstance().refs.middle            mainStore.dynamicList.length = 0            init()            window.addEventListener('scroll', scrollDynamic)        })        onBeforeUnmount(() => {            window.removeEventListener('scroll', scrollDynamic)        })        function pre() {            rollIndex.value > 0 ? rollIndex.value -= 1 : rollIndex.value = roll - 1            for (let i = 0; i < middle.children.length; i++) {                middle.children[i].style.left = rollIndex.value * 576 * -1 + 'px'            }        }        function next() {            rollIndex.value === roll - 1 ? rollIndex.value = 0 : rollIndex.value += 1            for (let i = 0; i < middle.children.length; i++) {                middle.children[i].style.left = rollIndex.value * 576 * -1 + 'px'            }        }        return {            list,            listIndex,            roll,            rollIndex,            pre,            next,            switchDynamic,            logo,        }    },}</script><style scoped>.dynamic {    background-color: white;    height: 112px;    width: 632px;    display: flex;    align-items: center;    justify-content: space-between;    border-radius: 4px;}.option {    width: 28px;    display: flex;    justify-content: center;}.option svg {    width: 14px;}.middle {    display: flex;    overflow: hidden;    width: 576px;}.up {    display: flex;    flex-direction: column;    align-items: center;    font-size: 12px;    width: 62px;    height: 80px;    justify-content: flex-start;    margin: 0 5px;    cursor: pointer;    transition: all .5s;    position: relative;    left: 0;}::-webkit-scrollbar {    display: none;}.up-avatar {    border-radius: 50%;    width: 40px;    height: 40px;    padding: 2px;    box-sizing: border-box;}.up-username {    width: 62px;    white-space: normal;    word-wrap: break-word;    text-align: center;    padding-top: 5px;}.active .up-avatar {    border: #23aedb solid 1px;    padding: 1px;}.active .up-username {    color: #23aedb;}.roll {    cursor: pointer;}.roll:hover path {    fill: #23aedb !important;}</style>